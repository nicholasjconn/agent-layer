#!/usr/bin/env bash
set -euo pipefail

# ./agent-layer - repo-local CLI entrypoint

# Resolve symlinks to find the actual script location.
SOURCE="$0"
while [[ -L "$SOURCE" ]]; do
  DIR="$(cd "$(dirname "$SOURCE")" && pwd -P)"
  SOURCE="$(readlink "$SOURCE")"
  # Resolve relative symlinks
  [[ "$SOURCE" != /* ]] && SOURCE="$DIR/$SOURCE"
done
SCRIPT_DIR="$(cd "$(dirname "$SOURCE")" && pwd -P)"
CLI="$SCRIPT_DIR/src/cli.mjs"

if [[ ! -f "$CLI" ]]; then
  printf "ERROR: Missing src/cli.mjs (expected near .agent-layer/).\n" >&2
  exit 2
fi

exec node "$CLI" "$@"
